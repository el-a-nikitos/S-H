====== RS485 с гальванической развязкой и без нее + шина UART с 3 и более устройствами ======
----

===== RS485 общий случай =====
==== "Емкостной" характер связи по осциллограмме ====
{{:debug:img_7208.jpg?400|}}

//Осциллограмма на A-B линии RS485//


**Решение:**
 
1) исключить или уменьшить сопротивление в измерительной цепи щупа осциллографа; 

2) проверить контакта/ качество пайки подводимых линий A и B - может быть непропай или трещина в пайке. 

----

==== Шумы около нуля превышают +/-100 мВ, пропадает связь при подключении осциллографа, появляется связь при подключении емкости (касание рукой) ====

{{:debug:img_7363.jpg?400|}}

//осциллограф работает от аккумулятора//

{{:debug:img_7364.jpg?400|}}

//осциллограф работает от сети 220В//

**Решение:** отключить осциллограф от сети питания - работа на аккумуляторе

----

===== RS485 с гальванической развязкой =====

==== Микросхема 2011ВВ024, импульсы внутри посылки ====
 
{{:debug:img_7153.jpg?400|}}
{{:debug:img_7154.jpg?400|}}

**Решение:** заземлить корпус - "20" контакт микросхемы 2011ВВ024 объединить с "11"/"12" контактом. 
<del>требуется комментарий производителя</del> 

----
===== RS485 без гальванической развязки =====

----

===== Шина UART =====
==== В шине UART есть ведомые контроллеры и ведомые преобразователи UART-RS485. Выходят на связь только контроллеры на шине RS485, подключенные через ведомый преобразователь UART-RS485 ====
 
**Исходные данные:**

Между линиями A-B шины RS485 стоит терминатор, пассивно стягивающий при свободной линии разницу напряжений A-B к нулю. 

Ведомые устройства (в том числе ведомый преобразователь USB-UART) подключены к RX мастера через диоды, а RX мастера удерживается в высоком состоянии благодаря пассивной подтяжке.

{{:debug:uart-шина.gif?200|}}

//Топология шины UART. "Вход 1" и "Вход 2" - TX ведомых устройств, "Выход" - RX мастера сети//

{{:debug:img_7365.jpg?400|}}

//Синяя осциллограмма - запрос мастера на TX мастера, желтая осциллограмма - ответ ведомого UART-контроллера на линии RX мастера//

{{:debug:img_7366.jpg?400|}}

//Осциллограмма - ответ ведомого UART-контроллера на линии RX мастера, совмещен ведомого UART-RS485 преобразователя (слева) и ответ ведомого контроллера (справа)//

**Вероятная причина:**

Обычно 

Мастер через ведомый преобразователь UART-RS485 поднимает шину RS485 в определенное высокое состояние на время своего запроса, и ведомый RS485-контроллер поднимает шину RS485 в определенное высокое состояние на время своего ответа - все работает. 

Вырожденный случай 

Когда шина RS485 не занята, ни одно устройство не удерживает шину в определенном низком или высоком состоянии и разность потенциалов A-B стремится к нулю. Ведомый преобразователь UART-RS485 может воспринять разность потенциалов в диапазоне неопределенности +/-200 мВ, как низкое состояние и в режиме "на чтение" (т.е. когда мастер сети ждет ответа) ведомый преобразователь будет удерживать RX мастера в низком состоянии. 

При запросе мастера к ведомому контроллеру ни одно устройство RS485 через ведомый преобразователь не станет отвечать и удерживать линию A-B ни в одном определенном состоянии, т.е. RX контроллера может удерживаться ведомым преобразователем UART-RS485 в низком состоянии. Т.к. подтяжка RX к высокому состоянию пассивная, а передача информации идет по схеме с открытым коллектором, то низкое состояния "шины UART" является "доминантным" и ведомый контроллер, отвечающий на запрос мастера, не способен самостоятельно поднять RX мастера в высокое состояние - мастер не примет ни одной логической 1.


**Решение 1** - программное со сроком "вчера": мастер удерживает ведомый преобразователь UART-RS485 в состоянии на выход (он, в свою очередь держит A-B в высоком состоянии и на линии RX мастера так же удерживается высокое состояние) всё время, пока ведомый контроллер на шине UART должен отвечать.

**Решение 2** - аппаратное, правильное: Пассивно доопределить линию A-B шины RS485 в высокое состояние. Подтянуть линию A к плюсу эфирного питания, а линию B к нулю эфирного питания через определенные сопротивления так, чтобы на свободной шине RS485 (ни один преобразователь ни одного устройства не настроен "на выход") состояние A-B было определено, как высокое - все преобразователи удерживают на RX своих контроллеров логическую 1.

**Решение 3** - самое правильное: отказаться от шины UART

----